<!doctype html>
<html lang="pl">
<head>
    <meta charset="utf-8">
</head>
<body>
    <div id="toc"></div>
    <div id="content">
        <h1>Rozdział 1</h1>
        <h2>Temat 1.1</h2>
        <h3>1 punkt</h3>
        <div>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Cras aliquet faucibus diam, vitae euismod quam fermentum nec. Mauris euismod odio at sapien maximus dignissim. Cras egestas sagittis sem non euismod. Vestibulum dictum volutpat tincidunt. Curabitur scelerisque libero in sem interdum, non placerat nisi suscipit. Etiam sollicitudin enim quis dolor venenatis vehicula sagittis in ligula. Curabitur nec sagittis purus, ac volutpat neque. In massa sapien, lacinia sed eros at, suscipit elementum lacus. Aenean dolor sem, rutrum eu justo a, malesuada viverra est. Aliquam erat lectus, convallis nec tellus quis, pharetra pharetra nisi. Fusce ullamcorper porta erat nec eleifend. Integer ante eros, molestie ultrices leo et, interdum lobortis eros.
        </div>
        <h3>2 punkt</h3>
        <div>
            Lorem ipsum dolor sit amet, consectetur adipiscing elit. Vivamus bibendum enim nec velit accumsan feugiat. Morbi malesuada augue aliquam, hendrerit mauris sed, volutpat metus. Nunc eget mollis nisi. Etiam at placerat sem. Nunc dapibus tellus mi, vehicula varius neque sollicitudin eu. Fusce dignissim orci ullamcorper odio convallis congue. Aenean tincidunt at urna dignissim scelerisque. Quisque et varius sem. Vivamus interdum cursus libero at iaculis. Ut turpis justo, volutpat laoreet condimentum in, euismod ut sapien. In neque purus, facilisis eu tincidunt id, interdum sed tortor.
        </div>
        <h3>3 punkt</h3>
        <div>
            Pellentesque aliquam tortor ac urna elementum cursus. Duis sem lacus, tincidunt sed purus vel, lobortis vehicula tellus. Etiam fringilla ultricies magna nec viverra. Donec nec consequat nunc. Suspendisse vitae aliquam augue. Nunc et vulputate dolor. Curabitur mattis lectus sed nulla porta cursus. Nunc tempor eget metus vitae mollis. Curabitur id rhoncus nisl.
        </div>
        <h2>Temat 1.2</h2>
        <h3>1 punkt</h3>
        <div>
            Proin vulputate, ante ac feugiat congue, erat erat dictum massa, vel tempus diam nibh ut arcu. Duis sed dictum dui, id cursus elit. Aliquam ultricies lorem vitae urna congue efficitur. Integer et neque et purus tristique mattis. Integer id nulla sapien. Integer vel lacinia dui, sit amet dictum turpis. Vestibulum finibus, ipsum non fermentum fermentum, neque nunc mattis lorem, nec congue purus libero et leo. Etiam condimentum a est ut efficitur. In eget auctor nulla. Suspendisse imperdiet convallis arcu, quis consectetur ante placerat vel. Phasellus vel purus a erat convallis tempus. Sed maximus efficitur lorem, non venenatis risus congue vitae. Vivamus rhoncus diam leo, vitae mattis mauris vulputate in. Nam vehicula mi ultrices justo gravida, in laoreet nibh facilisis. Vestibulum sit amet venenatis elit, eu varius arcu.
        </div>
        <h3>2 punkt</h3>
        <div>
            Donec ac ultrices mi. Suspendisse quis est semper elit posuere luctus. Donec pulvinar volutpat risus a pharetra. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Praesent lectus mauris, varius eget tincidunt eu, feugiat et felis. In eget cursus dui. Aliquam nec nisi sem. Quisque in consequat diam, sit amet condimentum est.
        </div>
        <h1>Rozdział 2</h1>
        <h2>Temat 2.1</h2>
        <h3>1 punkt</h3>
        <div>
            Sed pretium velit non eros dapibus tristique. Phasellus convallis eros non lacinia molestie. Aenean a tempor nunc. In porttitor accumsan tortor, sit amet convallis nisi mattis nec. Cras tristique imperdiet neque, id congue risus ultrices eu. Suspendisse vel leo libero. Mauris rhoncus posuere libero, volutpat faucibus tellus pulvinar non. Sed pellentesque libero vitae nibh fermentum rhoncus. Nulla id malesuada erat, vitae hendrerit felis.
        </div>
        <h3>2 punkt</h3>
        <div>
            Nam commodo orci lobortis justo suscipit aliquet. Curabitur a accumsan ligula. Curabitur egestas tincidunt varius. Vivamus et tellus ac est sodales scelerisque. Nunc ultricies luctus eros, quis condimentum felis feugiat vitae. Phasellus id ullamcorper ligula, id luctus eros. Duis turpis nisl, imperdiet quis eleifend sed, convallis egestas metus. Proin interdum lobortis enim sit amet sagittis. Donec vel sapien iaculis, vulputate quam sed, laoreet justo. Vestibulum et risus magna. Phasellus id egestas arcu.
        </div>
        <h2>Temat 2.2</h2>
        <h3>1 punkt</h3>
        <div>
            Integer eget sem nec ligula rutrum luctus. Curabitur aliquam nunc cursus tempor pretium. Pellentesque ac metus dui. Pellentesque ligula felis, commodo ut velit quis, scelerisque fermentum magna. Praesent lacus massa, pharetra eu orci sit amet, volutpat maximus dolor. Cras maximus, nibh sodales molestie efficitur, eros arcu placerat nisl, id laoreet lacus mauris et purus. Ut luctus ligula eros, a facilisis ligula convallis ac. 
        </div>
        <h3>2 punkt</h3>
        <div>
            Proin mollis lorem ac elementum eleifend. Etiam convallis venenatis turpis, quis interdum nisi vestibulum sit amet. Integer vitae dapibus tortor, in cursus mauris. Orci varius natoque penatibus et magnis dis parturient montes, nascetur ridiculus mus. Ut at dolor in purus imperdiet dignissim. Suspendisse vel ante feugiat, faucibus mi eu, hendrerit risus. Curabitur laoreet est a elit ornare, et commodo nisl porta. Ut ac odio et sem sagittis luctus. Cras maximus varius porttitor. Aenean tincidunt semper placerat. Nam pulvinar felis at iaculis euismod. Proin hendrerit sodales nisi sed ornare. Nam quis neque est. Vestibulum egestas urna nec fringilla pulvinar.
        </div>
    </div>

    <script>

        let toc = document.querySelector("#toc");
        let content = document.querySelectorAll("h1, h2, h3");
        let h1 = 0;
        let h2 = 0;
        let h3 = 0;
        for(let i of content)
        {
            if(i.id === "" && i.tagName === "H1")
            {
                h1++;
                i.id = h1;
                h2 = 0;
                h3 = 0;
            }
            else if(i.id === "" && i.tagName === "H2")
            {
                h2++;
                i.id = h1 + '-' + h2;
                h3 = 0;
            }
            else if(i.id === "" && i.tagName === "H3")
            {
                h3++;
                i.id = h1 + '-' + h2 + '-' + h3;
            }  
        }

        var headers = [];
        function walk(nodes)
        {
            nodes.forEach((node) =>
            {
                var sub = Array.from(node.childNodes);
                if(sub.length)
                {
                  walk(sub)
                }

                if(/h[1-6]/i.test(node.tagName))
                {
                    headers.push(
                    {
                        id: node.getAttribute('id'),
                        level: parseInt(node.tagName.replace('H', '')),
                        title: node.innerText
                    });
                }
            })
        }   

        walk(Array.from(document.querySelector("#content").childNodes));
        var link = (header) => '<li><a href="#' + header.id + '">' + header.title + '</a></li>';
        var html = '<ul>';

        headers.forEach((header, index) =>
        {
            if(index) 
            {
                var prev = headers[index - 1];
                console.log(index);
            }
            
            if(!index || prev.level === header.level) 
            {
                html += link(header);
            }
            else if(prev.level > header.level)
            {
                html += '</ul>' + link(header);
            }
            else if(prev.level < header.level)
            {
                html += '<ul>' + link(header);
            }
        });

        html += '</ul>';
        toc.innerHTML = html;

    </script>
</body>
</html>